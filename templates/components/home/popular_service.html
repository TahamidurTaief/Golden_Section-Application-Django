{% load static %}

<!-- Popular Section -->
<section class="section popular-section">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-lg-6 text-center wow fadeInUp" data-wow-delay="0.2s">
				<div class="section-header text-center mb-4">
					<h2 class="mb-1">Our Popular <span class="text-linear-primary">Services</span></h2>
					<p class="sub-title">Each listing is designed to be clear and concise, providing customers</p>
				</div>
			</div>
		</div>
		
		<!-- Dynamic Service Cards with Alpine.js Carousel -->
		<div class="position-relative" 
			x-data="{ 
				currentSlide: 0, 
				services: {{ popular_services|length }},
				// show 4 cards per view on large screens, responsive down to 1
				perSlide: window.innerWidth >= 1200 ? 4 : (window.innerWidth >= 768 ? 3 : (window.innerWidth >= 576 ? 2 : 1)),
				autoplay: null,
				get totalSlides() { return Math.ceil(this.services / this.perSlide); },
				prev() { this.currentSlide = this.currentSlide > 0 ? this.currentSlide - 1 : this.totalSlides - 1; },
				next() { this.currentSlide = this.currentSlide < this.totalSlides - 1 ? this.currentSlide + 1 : 0; },
				startAutoplay() {
					this.autoplay = setInterval(() => { this.next(); }, 3000);
				},
				stopAutoplay() {
					if (this.autoplay) clearInterval(this.autoplay);
				}
			}"
			x-init="
				startAutoplay();
				window.addEventListener('resize', () => { 
					perSlide = window.innerWidth >= 1200 ? 4 : (window.innerWidth >= 768 ? 3 : (window.innerWidth >= 576 ? 2 : 1)); 
					currentSlide = 0; 
				});
			"
			@mouseenter="stopAutoplay()" 
			@mouseleave="startAutoplay()">
			
			<div class="overflow-hidden">
				<div class="d-flex" :style="'transform: translateX(-' + (currentSlide * 100) + '%); transition: transform 0.5s ease-in-out;'">
					{% for service in popular_services %}
					<div class="flex-shrink-0 px-2 mb-4" :style="'flex: 0 0 ' + (100 / perSlide) + '%; max-width: ' + (100 / perSlide) + '%;'">
						<article class="position-relative overflow-hidden rounded-4 shadow-lg" style="max-width: 100%; height: 420px;">
							<!-- Service Image -->
							<a href="{% url 'services:detail' service.id %}">
								{% if service.featured_image %}
								<img src="{{ service.featured_image.url }}" 
									alt="{{ service.alt_text|default:service.name }}" 
									class="position-absolute w-100 h-100" 
									style="inset: 0; object-fit: cover;">
								{% else %}
								<img src="{% static 'img/services/service-01.jpg' %}" 
									alt="{{ service.name }}" 
									class="position-absolute w-100 h-100" 
									style="inset: 0; object-fit: cover;">
								{% endif %}
							</a>
							
							<!-- Gradient Overlay -->
							<div class="position-absolute w-100 h-100" style="inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);"></div>
							
							<!-- Content at Bottom -->
							<div class="position-absolute bottom-0 start-0 end-0 px-3 pb-3" style="z-index: 10;">
								<!-- Category Badge -->
								<span class="badge bg-primary bg-opacity-75 mb-2 text-white" style="font-size: 10px;">
									{{ service.category.name|default:"Service" }}
								</span>
								
								<!-- Service Name -->
								<h3 class="mb-2 fw-bold text-white" style="font-size: 18px; line-height: 1.2;">
									<a href="{% url 'services:detail' service.id %}" class="text-white text-decoration-none" title="{{ service.name }}">
										{{ service.name|truncatechars:35 }}
									</a>
								</h3>
								
								<!-- Rating (price removed as requested) -->
								<div class="d-flex align-items-center mb-2">
									<div class="text-white opacity-90" style="font-size: 13px;">
										<i class="ti ti-star-filled text-warning"></i> {{ service.rating|floatformat:1 }}
										<span class="opacity-75 ms-1">({{ service.total_reviews }})</span>
									</div>
								</div>
								
								<!-- Provider Info -->
								{% if service.provider %}
								<div class="text-white opacity-75 text-truncate" style="font-size: 11px;">
									<i class="ti ti-user"></i> {{ service.provider.business_name }}
								</div>
								{% endif %}
							</div>
						</article>
					</div>
					{% empty %}
					<div class="col-12 text-center py-5">
						<p class="text-muted">No popular services available at the moment.</p>
					</div>
					{% endfor %}
				</div>
			</div>
			
			<!-- Navigation Arrows -->
			{% if popular_services|length > 1 %}
			<button @click="prev(); stopAutoplay();" 
				class="btn btn-light rounded-circle position-absolute top-50 start-0 translate-middle-y shadow-lg" 
				style="width: 45px; height: 45px; z-index: 10; margin-left: 10px; opacity: 0.9;">
				<i class="ti ti-chevron-left fs-5"></i>
			</button>
			<button @click="next(); stopAutoplay();" 
				class="btn btn-light rounded-circle position-absolute top-50 end-0 translate-middle-y shadow-lg" 
				style="width: 45px; height: 45px; z-index: 10; margin-right: 10px; opacity: 0.9;">
				<i class="ti ti-chevron-right fs-5"></i>
			</button>
			
			<!-- Dot Indicators -->
			<div class="d-flex justify-content-center gap-2 mt-4" x-show="totalSlides > 1">
				<template x-for="i in totalSlides" :key="i">
					<button @click="currentSlide = i - 1; stopAutoplay();" 
						:class="currentSlide === i - 1 ? 'bg-primary' : 'bg-secondary'" 
						class="rounded-circle border-0 opacity-75 hover-opacity-100" 
						style="width: 10px; height: 10px; transition: all 0.3s;">
					</button>
				</template>
			</div>
			{% endif %}
		</div>
		
		<div class="row mt-5">
			<div class="col-md-12">
				<div class="text-center wow fadeInUp" data-wow-delay="0.2s">
					<a href="{% url 'services:list' %}" class="btn btn-dark">View All<i class="ti ti-arrow-right ms-2"></i></a>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- /Popular Section -->
