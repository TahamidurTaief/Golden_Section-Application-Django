{% load static %}

<!-- Latest Service Cards Slider - Dynamic -->
<div class="position-relative mb-5 wow fadeInUp" data-wow-delay="0.3s" 
	x-data="{ 
		currentSlide: 0,
		services: {{ latest_services|length }},
		perSlide: window.innerWidth >= 992 ? 3 : (window.innerWidth >= 576 ? 2 : 1),
		get totalSlides() { return Math.max(1, Math.ceil(this.services / this.perSlide)); },
		next() { this.currentSlide = (this.currentSlide + 1) % this.totalSlides; },
		prev() { this.currentSlide = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides; }
	}"
	x-init="
		window.addEventListener('resize', () => { 
			perSlide = window.innerWidth >= 992 ? 3 : (window.innerWidth >= 576 ? 2 : 1); 
			currentSlide = 0; 
		});
	">
	<div class="overflow-hidden">
		<div class="d-flex" 
			:style="`transform: translateX(-${currentSlide * 100}%); transition: transform 0.5s ease-in-out;`">
			{% for service in latest_services %}
			<div class="px-2 flex-shrink-0" 
				:style="'flex: 0 0 ' + (100 / perSlide) + '%; max-width: ' + (100 / perSlide) + '%;'">
				<div class="card rounded-lg overflow-hidden h-100 d-flex flex-column border-0 shadow">
					<div class="position-relative">
						<a href="{% url 'services:detail' service.id %}">
							{% if service.featured_image %}
								<img class="card-img-top w-100" 
									src="{{ service.featured_image.url }}" 
									alt="{{ service.alt_text|default:service.name }}"
									style="height: 220px; object-fit: cover;">
							{% else %}
								<img class="card-img-top w-100" 
									src="{% static 'img/services/service-01.jpg' %}" 
									alt="{{ service.name }}"
									style="height: 220px; object-fit: cover;">
							{% endif %}
						</a>
						<span class="badge bg-primary position-absolute top-0 end-0 m-2">New</span>
					</div>
					<div class="card-body px-4 pt-3 flex-grow-1 d-flex flex-column">
						<span class="badge bg-light text-dark mb-2 align-self-start">{{ service.category.name }}</span>
						<h6 class="card-title fw-semibold mb-2 text-dark" style="font-size: 1.1rem;">
							{{ service.name|truncatewords:8 }}
						</h6>
						<p class="card-text text-muted small flex-grow-1" style="font-size: 0.875rem;">
							{{ service.short_description|truncatewords:15 }}
						</p>
					</div>
					<div class="card-footer bg-white border-0 px-4 pt-0 pb-3">
						<div class="d-flex justify-content-between align-items-center">
							<span class="d-flex align-items-center">
								<i class="ti ti-star-filled text-warning me-1"></i>
								<span class="fw-semibold text-dark">{{ service.rating|floatformat:1 }}</span>
								<span class="text-muted small ms-1">({{ service.total_reviews }})</span>
							</span>
							<a href="{% url 'services:detail' service.id %}" 
								class="text-sm d-flex align-items-center gap-1 btn btn-link text-primary p-0">
								See More
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
							</a>
						</div>
					</div>
				</div>
			</div>
			{% empty %}
			<div class="col-12 px-2">
				<div class="alert alert-info text-center">
					<i class="ti ti-info-circle me-2"></i>
					No services available in this category.
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
	
	<!-- Navigation Controls -->
	{% if latest_services|length > 3 %}
	<div>
		<!-- Navigation Arrows -->
		<button @click="prev()" 
			class="position-absolute top-50 start-0 translate-middle-y btn btn-primary rounded-circle"
			style="width: 50px; height: 50px; z-index: 10; margin-left: -25px;">
			<i class="ti ti-chevron-left"></i>
		</button>
		<button @click="next()" 
			class="position-absolute top-50 end-0 translate-middle-y btn btn-primary rounded-circle"
			style="width: 50px; height: 50px; z-index: 10; margin-right: -25px;">
			<i class="ti ti-chevron-right"></i>
		</button>
		
		<!-- Dots Indicator -->
		<div class="d-flex justify-content-center gap-2 mt-4">
			<template x-for="i in totalSlides" :key="i">
				<button @click="currentSlide = i - 1"
					:class="currentSlide === i - 1 ? 'bg-primary' : 'bg-secondary'"
					class="rounded-circle border-0"
					style="width: 10px; height: 10px; opacity: 0.7; transition: all 0.3s;">
				</button>
			</template>
		</div>
	</div>
	{% endif %}
</div>
<!-- /Latest Service Cards Slider -->
