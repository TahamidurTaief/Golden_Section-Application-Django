{% load static %}

<div class="row justify-content-center">
  {% for category in categories %}
  <div class="col-lg-4 col-md-6">
    <div class="category-list rounded mb-4">
      <!-- Use HTMX to fetch filtered services and update services list without full page reload.
           Also push the URL so users can share or bookmark the filtered view. -->
      <a href="{% url 'core:services' %}?category={{ category.slug }}"
        {% if 'services' in request.path %}
        hx-get="{% url 'core:services' %}?category={{ category.slug }}&page=1"
        hx-target="#services-row"
        hx-swap="outerHTML"
        hx-push-url="true"
        hx-indicator="#loading-indicator"
        hx-include="[name='keyword'], [name='category']:checked, [name='subcategory']:checked"
        onclick="(function(){
          // set the category checkbox on the services sidebar so the filter UI reflects this selection
          const checkboxes = document.querySelectorAll('[name=\'category\']');
          checkboxes.forEach(c => c.checked = (c.value === '{{ category.slug }}'));
          return false;
        })();"
        {% endif %}>
        <img
          src="{% if category.image %}{{ category.image_card.url }}{% else %}{% static 'img/services/service-01.jpg' %}{% endif %}"
          class="img-fluid"
          alt="{{ category.name }}"
          onerror="this.onerror=null; this.src='{% static 'img/services/service-01.jpg' %}';"
        />
        <div
          class="service-img bg-secondary d-flex justify-content-between align-items-center"
        >
          <div class="inner-content d-flex align-items-center">
            <span
              class="service-icon bg-primary avatar avatar-md text-white me-2"
            >
              {% if category.icon %}
              <img
                src="{{ category.icon.url }}"
                class="img-fluid"
                alt="{{ category.name }}"
                onerror="this.onerror=null; this.src='{% static 'img/icons/category-01.svg' %}';"
              />
              {% else %}
              <img
                src="{% static 'img/icons/category-01.svg' %}"
                class="img-fluid"
                alt="icon"
              />
              {% endif %}
            </span>
            <h5 class="text-white">{{ category.name }}</h5>
          </div>
          <p class="fs-14 me-2">{{ category.total_services }} Service{{ category.total_services|pluralize }}</p>
        </div>
      </a>
    </div>
  </div>
  {% empty %}
  <div class="col-12 text-center py-5">
    <p class="text-muted">No categories available at the moment.</p>
  </div>
  {% endfor %}
</div>
